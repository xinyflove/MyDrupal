    <div class="easyui-layout" data-options="fit:true">        <div class="maintop" data-options="region:'north',border:false">            <div class="main_header">                <form id="daQueryForm" method="post">                    <input id="daOrgType" type="hidden" name="orgType" value="device"/>                    <input id="daDevID" type="hidden" name="devID" value="0"/>                    <div class="formTable">                    <div style="width:100%; height:50px; line-height:50px; font-size:13px; color:#292f34;">                        <div style="margin-left:5%; float:left;">                            <span style="margin-right:5px;">查询指标</span>                            <select id="queryIndexCC" class="easyui-combobox" name="queryIndex" style="width:260px;" data-options="                                valueField : 'value',                                textField: 'label',                                onSelect:function(rec){                                                                    }">                                <option value="1">周期内水系统排名</option>                                <option value="2">周期内二维码巡检排名</option>                                <option value="3">周期内视频告警排名</option>                              </select>                        </div>                                                <div style="margin-left:4%; float:left; vertical-align:middle">                            <span style="margin-right:5px">起止时间</span>                            <input class="easyui-datebox" id="querystarttime" name="querystart"                data-options="required:true" value="3/4/2015" style="width:150px">                            <span>--------</span>                            <input class="easyui-datebox" id="queryendtime" name="queryend"                data-options="required:true" value="3/4/2015" style="width:150px">                        </div>                    </div>                    <div style="width:97%; height:50px; line-height:50px; text-align:right;">                        <a id="backBtn" href="javascript:;" class="easyui-linkbutton" data-options="width:80" onclick="backRankPage('<?php echo $p_dis ?>')">返回</a>                        <a id="queryBtn" href="#" class="easyui-linkbutton" data-options="width:80" onclick="doDrawDataChart()">查询</a>                        <a id="resetBtn" href="#" class="easyui-linkbutton" data-options="width:80" onclick="resetForm('daQueryForm')">重置</a>                        <a id="exportBtn" href="#" class="easyui-linkbutton" data-options="width:80" onclick="da_export2file()">导出</a>                    </div>                </div>                </form>            </div>                    </div>        <!--main_header end-->        <div class="main_data" data-options="region:'center',border:false">            <div class="resultBox">                               <div class="result-main">                <table id="rankdg"                    sortName="itemid" sortOrder="asc"                    rownumbers="false" pagination="true">                <!-- <thead>                    <tr>                        <th field="itemid" width="80" sortable="true">排名</th>                        <th field="productid" width="100" sortable="true">企业</th>                        <th field="listprice" width="80" align="right" sortable="true">监测点</th>                        <th field="unitcost" width="80" align="right" sortable="true">报警时间</th>                        <th field="attr1" width="220">故障点</th>                        <th field="status" width="60" align="center">合格率</th>                    </tr>                </thead> -->            </table>                </div>            </div>        </div>    </div><script type="text/javascript">var columns_water = [[        {field:'itemid',title:'排名',width:'80',sortable:true},        {field:'productid',title:'企业',width:'100',sortable:true},        {field:'listprice',title:'监测点',width:'80',sortable:true},        {field:'unitcost',title:'报警时间',width:'80',sortable:true},        {field:'attr1',title:'故障点',width:'220'},        {field:'status',title:'合格率',width:'60',align:"center"},    ]];var columns_ewm = [[        {field:'itemid',title:'排名',width:'80',sortable:true},        {field:'productid',title:'企业',width:'100',sortable:true},        {field:'total',title:'总数',width:'80',sortable:true},        {field:'currmonnum',title:'本月巡检数',width:'200',sortable:true},        {field:'status',title:'合格率',width:'60',align:"center"},    ]];var columns_jksp = [[        {field:'itemid',title:'排名',width:'80',sortable:true},        {field:'productid',title:'企业',width:'100',sortable:true},        {field:'alarmnum',title:'报警数',width:'60',align:"center"},    ]];$(function(){    // 综合排名获取数据    /*$('#rankdg').datagrid({        data:[<?php print $dev;?>],    });*/    $('#rankdg').datagrid({            url:'/fire_main/get/ajax/kpi/rank/data/qu?org_list=<?php print $org_list;?>',        columns:columns_water,    }); });function doDrawDataChart(){    queryIndex = $('#queryIndexCC').combobox('getValue');    startDate = $('#querystarttime').datebox('getValue');    endDate = $('#queryendtime').datebox('getValue');    s=Date.parse(startDate.replace(/-/g,"/"));    e= Date.parse(endDate.replace(/-/g,"/"));        if((startDate!=="")&&(endDate !== "")){        if(s>e){            $.messager.alert('错误', '开始日期必须早于结束日期');            var curr_time = new Date();            $("#querystarttime").datebox("setValue",myformatter(curr_time));              $("#queryendtime").datebox("setValue",myformatter(curr_time));            return false;        }        now = new Date();        year = now.getFullYear();        month = now.getMonth();        date = now.getDate();        nowDay = year+'-'+(month+1)+'-'+date;        n= Date.parse(nowDay.replace(/-/g,"/"));        if(e>n){            $.messager.alert('错误', '结束日期不得大于今天日期');            var curr_time = new Date();            $("#querystarttime").datebox("setValue",myformatter(curr_time));              $("#queryendtime").datebox("setValue",myformatter(curr_time));            return false;        }    }    else    {        $.messager.alert('错误', '请选择开始日期和结束日期');        return false;    }    if(queryIndex == ''){        $.messager.show({// show error message            title: '错误',            msg: '请先选择一个查询指标'        });        return false;    }    if(queryIndex == 1) columns = columns_water    if(queryIndex == 2) columns = columns_ewm    if(queryIndex == 3) columns = columns_jksp    $('#rankdg').datagrid({        url:'/fire_main/get/ajax/kpi/rank/data/qu?org_list=<?php print $org_list;?>&queryIndex='+queryIndex+'&startDate='+startDate+'&endDate='+endDate,        columns:columns,    }); }function da_export2file(){    var start = $('#querystarttime').datebox('getValue');    var end = $('#queryendtime').datebox('getValue');    var p1 =  $('#queryIndexCC').combobox('getValue');    var s=Date.parse(start.replace(/-/g,"/"));    var e= Date.parse(end.replace(/-/g,"/"));    if((start!=="")&&(end !== "")){        if(s>e){            $.messager.alert('错误', '开始日期必须早于结束日期');            var curr_time = new Date();            $("#querystarttime").datebox("setValue",myformatter(curr_time));              $("#queryendtime").datebox("setValue",myformatter(curr_time));            return false;        }    }    else    {        $.messager.alert('错误', '请选择开始日期和结束日期');        return false;    }    if(p1==''){        $.messager.show({// show error message            title: '错误',            msg: '请先选择一个查询指标'        });        return false;    }else{        //window.location.href='/data/excel/export/kpi/rank?s='+start+'&e='+end+'&p1='+p1;        //window.open('/data/excel/export/kpi/rank?s='+start+'&e='+end+'&p1='+p1);        $.post(            '/data/excel/export/kpi/rank',            {                org_list:'<?php print $org_list;?>',                s:start,                e:end,                p1,p1            },            function(data,status){                if(status == 'success')                {                    data = eval("("+data+")");                    if(data.code == '1')                    {                        $.messager.alert('提示', data.msg);                        window.open(data.href);                    }                    else                    {                        $.messager.alert('提示', data.msg);                    }                                    }            }        );    }}function goCorpPage(uri){    var start = $('#querystarttime').datebox('getValue');    var end = $('#queryendtime').datebox('getValue');    $('#mainContent').panel('refresh','/kpi/rank/'+uri+'?s='+start+'&e='+end);}function backRankPage(uri){    $('#mainContent').panel('refresh','/kpi/rank/'+uri);}function myformatter(date){      var y = date.getFullYear();      var m = date.getMonth()+1;      var d = date.getDate();      return y+'-'+(m<10?('0'+m):m)+'-'+(d<10?('0'+d):d);  }</script>